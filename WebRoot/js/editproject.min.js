$(function(){for(var o,e=$("body"),t=e.find(".contrainer"),a=t.find("#project-form"),n=a.find(".form-markdown-items"),i=n.find(".form-markdown-operations").find(".btn"),r=a.find(".form-operations-item"),c=r.find(".btn-submit"),d=r.find(".btn-cancel"),p=window.location,l=decodeURI(p.search),s="",w="",m="",f="",g=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/getAllProject/",u=!1,h=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/selectPageById/",j=!1,v=l.replace(/\?\s*/g,"").split("&"),y=0,b=v.length;y<b;y++){var k=v[y].split("=");"projectid"===k[0]&&(s=k[1]||""),"projectname"===k[0]&&(projectName=k[1]||""),"check"===k[0]&&(w=k[1]||""),"type"===k[0]&&(m=k[1]||""),"pageid"===k[0]&&(f=k[1]||"")}"copy"===m||"edit"===m?$.ajax({url:h+f+"/"+s,type:"GET",dataType:"json",success:function(e){var t=e;t.result?$.ajax({url:g+s,type:"GET",dataType:"json",success:function(e){var n=a.find(".form-items").find("#_pageparent"),i="";"copy"===m?a.find(".form-items-title").find("#_pagetitle").val(t.page.pagetitle+"（副本）"):a.find(".form-items-title").find("#_pagetitle").val(t.page.pagetitle),a.find(".form-items-sort").find("#_pagesortid").val(t.page.pagesortid);for(var r=0,c=e.length;r<c;r++)i+=e[r].subProjectId===t.page.pagesubprejectid?'<option value="'+e[r].subProjectId+'" selected="selected">'+e[r].subProjectName+"</option>":'<option value="'+e[r].subProjectId+'">'+e[r].subProjectName+"</option>";n.html(i),o=editormd("markdown-editormd",{markdown:t.page.pagecontext,height:720,path:"../lib/",htmlDecode:"style,script,iframe",placeholder:"用mardown语法编辑你的项目,右边可以实时预览",onload:function(){j=!0}})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}}):console.log(e)},error:function(o){console.log(o)}}):(o=editormd("markdown-editormd",{height:720,path:"../lib/",htmlDecode:"style,script,iframe",placeholder:"用mardown语法编辑你的项目,右边可以实时预览",onload:function(){j=!0}}),$.ajax({url:g+s,type:"GET",dataType:"json",success:function(o){for(var e=a.find(".form-items").find("#_pageparent"),t="",n=0,i=o.length;n<i;n++)t+='<option value="'+o[n].subProjectId+'">'+o[n].subProjectName+"</option>";e.html(t)},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})),i.on("click",function(){var e=$(this).data("role");switch(e){case"API":j?$.get("./tpls/api.md",function(e){o.clear(),o.appendMarkdown(e)}):layer.msg("markdown编辑区还未能完成初始化，请您在给它一点时间啦!",{time:1500});break;case"data":j?$.get("./tpls/data.md",function(e){o.clear(),o.appendMarkdown(e)}):layer.msg("markdown编辑区还未能完成初始化，请您在给它一点时间啦!",{time:1500});break;case"http":}}),c.on("click",function(e){var t=a.find(".form-items-title").find("#_pagetitle"),n=a.find(".form-items-sort").find("#_pagesortid"),i=a.find("#_pageparent"),r=t.val(),c=parseInt(n.val()),d=i.val(),p=o.getMarkdown(),l=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/addPage",g=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/updatePage",h={pageprojectid:s,pagesubprejectid:d,pagetitle:r};isNaN(c)||(h.pagesortid=c),""!==w&&(h.pageprojectpassword=w),""!==p&&(h.pagecontext=p),u||("edit"===m?(h.pageid=f,$.ajax({url:g,type:"POST",dataType:"json",data:h,success:function(o){iscreatingdir=!1;var e=o.result;e?layer.msg("已成功更新页面并保存",{time:1e3},function(){var e=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/showproject.jsp?id="+s+"&projectname="+projectName+"&check="+w+"&pageid="+o.page.pageid;window.location.href=e}):layer.msg(o.message,{time:1500})},error:function(o){console.log(o)}})):$.ajax({url:l,type:"POST",dataType:"json",data:h,success:function(o){iscreatingdir=!1;var e=o.result;e?layer.msg("已成功创建页面并保存",{time:1e3},function(){var e=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/showproject.jsp?id="+s+"&projectname="+projectName+"&check="+w+"&pageid="+o.page.pageid;window.location.href=e}):layer.msg(o.message,{time:1500})},error:function(o){console.log(o)}})),e.preventDefault(),e.stopPropagation()}),d.on("click",function(){var o=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/showproject.jsp?id="+s+"&projectname="+projectName+"&check="+w;window.location.href=o,event.preventDefault(),event.stopPropagation()})});