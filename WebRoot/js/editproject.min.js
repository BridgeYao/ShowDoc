$(function(){for(var o,e=$("body"),t=e.find(".contrainer"),i=t.find("#project-form"),a=i.find(".form-markdown-items"),n=a.find(".form-markdown-operations").find(".btn"),c=i.find(".form-operations-item"),r=c.find(".btn-submit"),d=c.find(".btn-cancel"),p=window.location,l=decodeURI(p.search),s="",w="",m="",f="",g=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/getAllProject/",h=!1,u=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/selectPageById/",j=!1,y=l.replace(/\?\s*/g,"").split("&"),v=0,b=y.length;v<b;v++){var k=y[v].split("=");"projectid"===k[0]&&(s=k[1]||""),"projectname"===k[0]&&(projectName=k[1]||""),"check"===k[0]&&(w=k[1]||""),"type"===k[0]&&(m=k[1]||""),"pageid"===k[0]&&(f=k[1]||"")}"copy"===m||"edit"===m?$.ajax({url:u+f+"/"+s,type:"GET",dataType:"json",success:function(e){var t=e;t.result?$.ajax({url:g+s,type:"GET",dataType:"json",success:function(e){var a=i.find(".form-items").find("#_pageparent"),n="";"copy"===m?i.find(".form-items-title").find("#_pagetitle").val(t.page.pagetitle+"（副本）"):i.find(".form-items-title").find("#_pagetitle").val(t.page.pagetitle),i.find(".form-items-sort").find("#_pagesortid").val(t.page.pagesortid);for(var c=0,r=e.length;c<r;c++)n+=e[c].subProjectId===t.page.pagesubprejectid?'<option value="'+e[c].subProjectId+'" selected="selected">'+e[c].subProjectName+"</option>":'<option value="'+e[c].subProjectId+'">'+e[c].subProjectName+"</option>";a.html(n),o=editormd("markdown-editormd",{markdown:t.page.pagecontext,height:720,path:"../lib/",htmlDecode:"style,script,iframe",placeholder:"用mardown语法编辑你的项目,右边可以实时预览",onload:function(){j=!0}})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}}):console.log(e)},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}}):(o=editormd("markdown-editormd",{height:720,path:"../lib/",htmlDecode:"style,script,iframe",placeholder:"用mardown语法编辑你的项目,右边可以实时预览",onload:function(){j=!0}}),$.ajax({url:g+s,type:"GET",dataType:"json",success:function(o){for(var e=i.find(".form-items").find("#_pageparent"),t="",a=0,n=o.length;a<n;a++)t+='<option value="'+o[a].subProjectId+'">'+o[a].subProjectName+"</option>";e.html(t)},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})),n.on("click",function(){var e=$(this).data("role");switch(e){case"API":j?$.get("./tpls/api.md",function(e){o.clear(),o.appendMarkdown(e)}):layer.msg("markdown编辑区还未能完成初始化，请您在给它一点时间啦!",{time:1500});break;case"data":j?$.get("./tpls/data.md",function(e){o.clear(),o.appendMarkdown(e)}):layer.msg("markdown编辑区还未能完成初始化，请您在给它一点时间啦!",{time:1500});break;case"http":}}),r.on("click",function(e){var t=i.find(".form-items-title").find("#_pagetitle"),a=i.find(".form-items-sort").find("#_pagesortid"),n=i.find("#_pageparent"),c=t.val(),r=parseInt(a.val()),d=n.val(),p=o.getMarkdown(),l=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/addPage",g=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/updatePage",u={pageprojectid:s,pagesubprejectid:d,pagetitle:c};isNaN(r)||(u.pagesortid=r),""!==w&&(u.pageprojectpassword=w),""!==p&&(u.pagecontext=p),h||("edit"===m?(u.pageid=f,$.ajax({url:g,type:"POST",dataType:"json",data:u,success:function(o){iscreatingdir=!1;var e=o.result;e?layer.msg("已成功更新页面并保存",{time:1e3},function(){var e=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/showproject.jsp?id="+s+"&projectname="+projectName+"&check="+w+"&pageid="+o.page.pageid;window.location.href=e}):layer.msg(o.message,{time:1500})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})):$.ajax({url:l,type:"POST",dataType:"json",data:u,success:function(o){iscreatingdir=!1;var e=o.result;e?layer.msg("已成功创建页面并保存",{time:1e3},function(){var e=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/showproject.jsp?id="+s+"&projectname="+projectName+"&check="+w+"&pageid="+o.page.pageid;window.location.href=e}):layer.msg(o.message,{time:1500})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})),e.preventDefault(),e.stopPropagation()}),d.on("click",function(){var o=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/showproject.jsp?id="+s+"&projectname="+projectName+"&check="+w;window.location.href=o,event.preventDefault(),event.stopPropagation()})});