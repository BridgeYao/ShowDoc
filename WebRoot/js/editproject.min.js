$(function(){for(var o,e=$("body"),t=e.find(".contrainer"),a=t.find("#project-form"),n=a.find(".form-markdown-items"),i=n.find(".form-markdown-operations").find(".btn"),r=a.find(".form-operations-item"),c=r.find(".btn-submit"),p=r.find(".btn-cancel"),d=window.location,s=decodeURI(d.search),l="",w="",f="",g="",m=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/getAllProject/",u=!1,h=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/selectPageById/",j=s.replace(/\?\s*/g,"").split("&"),v=0,y=j.length;v<y;v++){var b=j[v].split("=");"projectid"===b[0]&&(l=b[1]||""),"projectname"===b[0]&&(projectName=b[1]||""),"check"===b[0]&&(w=b[1]||""),"type"===b[0]&&(f=b[1]||""),"pageid"===b[0]&&(g=b[1]||"")}"copy"===f||"edit"===f?$.ajax({url:h+g+"/"+l,type:"GET",dataType:"json",success:function(e){var t=e;t.result?$.ajax({url:m+l,type:"GET",dataType:"json",success:function(e){var n=a.find(".form-items").find("#_pageparent"),i="";"copy"===f?a.find(".form-items-title").find("#_pagetitle").val(t.page.pagetitle+"（副本）"):a.find(".form-items-title").find("#_pagetitle").val(t.page.pagetitle),a.find(".form-items-sort").find("#_pagesortid").val(t.page.pagesortid);for(var r=0,c=e.length;r<c;r++)i+=e[r].subProjectId===t.page.pagesubprejectid?'<option value="'+e[r].subProjectId+'" selected="selected">'+e[r].subProjectName+"</option>":'<option value="'+e[r].subProjectId+'">'+e[r].subProjectName+"</option>";n.html(i),o=editormd("markdown-editormd",{markdown:t.page.pagecontext,height:720,path:"../lib/",htmlDecode:"style,script,iframe",placeholder:"用mardown语法编辑你的项目,右边可以实时预览"})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{timeout:3e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}}):console.log(e)},error:function(o){console.log(o)}}):(o=editormd("markdown-editormd",{height:720,path:"../lib/",htmlDecode:"style,script,iframe",placeholder:"用mardown语法编辑你的项目,右边可以实时预览"}),$.ajax({url:m+l,type:"GET",dataType:"json",success:function(o){for(var e=a.find(".form-items").find("#_pageparent"),t="",n=0,i=o.length;n<i;n++)t+='<option value="'+o[n].subProjectId+'">'+o[n].subProjectName+"</option>";e.html(t)},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{timeout:3e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})),i.on("click",function(){var e=$(this).data("role");switch(e){case"API":$.get("./tpls/api.md",function(e){o.appendMarkdown(e)});break;case"data":$.get("./tpls/data.md",function(e){o.appendMarkdown(e)});break;case"json":console.log("json");break;case"http":console.log("http")}}),c.on("click",function(e){var t=a.find(".form-items-title").find("#_pagetitle"),n=a.find(".form-items-sort").find("#_pagesortid"),i=a.find("#_pageparent"),r=t.val(),c=parseInt(n.val()),p=i.val(),d=o.getMarkdown(),s=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/addPage",m=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/updatePage",h={pageprojectid:l,pagesubprejectid:p,pagetitle:r};isNaN(c)||(h.pagesortid=c),""!==w&&(h.pageprojectpassword=w),""!==d&&(h.pagecontext=d),u||("edit"===f?(h.pageid=g,$.ajax({url:m,type:"POST",dataType:"json",data:h,success:function(o){iscreatingdir=!1;var e=o.result;e?layer.msg("已成功更新页面并保存",{time:3e3},function(){var e=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/showproject.jsp?id="+l+"&projectname="+projectName+"&check="+w+"&pageid="+o.page.pageid;window.location.href=e}):layer.msg(o.message,{time:3e3})},error:function(o){console.log(o)}})):$.ajax({url:s,type:"POST",dataType:"json",data:h,success:function(o){iscreatingdir=!1;var e=o.result;e?layer.msg("已成功创建页面并保存",{time:3e3},function(){var e=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/showproject.jsp?id="+l+"&projectname="+projectName+"&check="+w+"&pageid="+o.page.pageid;window.location.href=e}):layer.msg(o.message,{time:3e3})},error:function(o){console.log(o)}})),e.preventDefault(),e.stopPropagation()}),p.on("click",function(){var o=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/showproject.jsp?id="+l+"&projectname="+projectName+"&check="+w;window.location.href=o,event.preventDefault(),event.stopPropagation()})});