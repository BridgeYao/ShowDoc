$(function(){function o(){$.ajax({url:G+i+"/-1",type:"GET",dataType:"json",success:function(o){for(var t="",e=o.length,a=0;a<e;a++)t+='<li class="dir-item" data-tooltip="目录：'+o[a].subprojectname+'"><a href="javascript:void(0);" class="btn btn-dir" data-type="dir" data-parent="'+o[a].subprojectid+'"><span class="triangle left"></span>'+o[a].subprojectname+"</a></li>";$.ajax({url:O+"-1/"+i,type:"GET",dataType:"json",success:function(o){for(var e=o.length,a=0;a<e;a++)t+='<li class="page-item" data-tooltip="page：'+o[a].pagetitle+'"><a href="javascript:void(0);" class="btn btn-page" data-type="page" data-page="'+o[a].pageid+'" data-parent="-1">'+o[a].pagetitle+"</a></li>";w.html(t),$pages=w.find(".page-item").find(".btn-page");for(var a=0,i=$pages.length;a<i;a++)$pages.eq(a).data("page")==E&&$pages.eq(a).addClass("active")},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})}function t(){k=$(document).height(),T=D>k?D:k,P.css("height",T).fadeIn(200),P.load("./tpls/share-page.html",function(o,t,e){var a=P.find(".page-share-container"),i=a.find(".link-address").find(".link"),n=a.height(),r=(D-n)/2;r=r>0?r:20,i.text(I),a.css("top",-n).animate({opacity:"1",top:r},200,function(){a.animate({top:r-30},200,function(){a.animate({top:r},200)})})})}function e(o){$.ajax({url:o,type:"GET",dataType:"json",success:function(o){b.text(o.page.pagetitle),""===n?n=editormd("test-editormd",{width:0,height:0,path:"../lib/",onload:function(){editormd.markdownToHTML("markdown-content",{markdown:o.page.pagecontext})}}):(y.html(""),editormd.markdownToHTML("markdown-content",{markdown:o.page.pagecontext})),v.fadeIn(function(){setTimeout(100,function(){console.log("page"),v.attr({"data-page":o.page.pageid,"data-project":o.page.pageprojectid,"data-parent":o.page.pagesubprejectid}).slideDown(500,function(){})},200)})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})}function a(o){$.ajax({url:o,type:"GET",dataType:"json",success:function(o){for(var t=P.find(".edit-dir-container"),e=t.find(".exited-dir").find(".dir-list"),a=t.find(".edit-dir-form").find(".form-item").find("#_dirparname"),i="",n="",r=t.height(),c=0,d=o.length;c<d;c++)i+='<option value="'+o[c].subProjectName+'" data-level="'+o[c].nextLevel+'" data-parent="'+o[c].subProjectId+'">'+o[c].subProjectName+"</option>","无"!==o[c].subProjectName&&(n+='<li class="dir-item"><a href="javascript:void(0);" class="item-name btn" data-event="editdir" data-parent="'+o[c].subProjectId+'">'+o[c].subProjectName+"</a></li>");a.html(i),e.html(n),r=t.height()+(D-r>0?D-r:20),T=T>r?T:r,P.css("height",T)},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})}var i,n="",r=$("body"),c=r.find("#header"),d=c.find(".common-middle").find(".middle-title"),s=c.find(".common-right").eq(0),l=s.find(".btn-manage"),p=c.find(".feature-list"),m=r.find("#main"),f=m.find(".sideNav"),w=f.find("#project-nav").find("#project-list"),u=f.find(".add-item-operations").find(".btn-add-page"),h=f.find(".add-item-operations").find(".btn-add-dir"),g=f.find("#project-nav"),v=(g.find(".btn-dir"),g.find(".btn-page"),m.find(".show-content")),j=v.find(".content-operations"),b=(j.find(".btn-share"),j.find(".btn-copy"),j.find(".btn-edit"),j.find(".btn-remove"),v.find(".content-title").find(".title")),y=v.find("#markdown-content"),P=r.find("#mask"),S=!1,D=$(window).height(),k=$(document).height(),T=D>k?D:k,x=!1,I=window.location,N=decodeURI(I.search),C="",_="",E="",G=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/querySubProject/",O=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/selectPageByPid/",q=[],A=!1,L=!1,B="",H=!1;isdeletingdir=!1;for(var M=N.replace(/\?\s*/g,"").split("&"),U=0,R=M.length;U<R;U++){var z=M[U].split("=");"id"===z[0]&&(i=z[1]||""),"projectname"===z[0]&&(C=z[1]||""),"check"===z[0]&&(_=z[1]||""),"pageid"===z[0]&&(E=z[1]||"")}d.text(C),o(),""!=E&&(B=E,e(window.location.protocol+"//"+window.location.host+"/ShowDoc/page/selectPageById/"+E+"/"+i)),u.on("click",function(o){var t=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/editproject.jsp?projectid="+i+"&projectname="+C+"&check="+_+"&type=new";window.location.href=t,o.preventDefault(),o.stopPropagation()}),h.on("click",function(){k=$(document).height(),T=D>k?D:k,P.css("height",T).fadeIn(200),P.load("tpls/create-dir.html",function(o,t,e){var a=P.find(".create-dir-container"),n=a.height(),r=(D-n)/2;r=r>0?r:20,a.css("top",-n).animate({top:r,opacity:1},200,function(){var o=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/getAllProject/"+i;$.ajax({url:o,type:"GET",dataType:"json",success:function(o){for(var t=a.find(".form-item").find("#_dirparname"),e=a.find(".exited-dir").find(".dir-list"),i="",r="",c=0,d=o.length;c<d;c++)i+='<option value="'+o[c].subProjectName+'" data-level="'+o[c].nextLevel+'" data-parent="'+o[c].subProjectId+'">'+o[c].subProjectName+"</option>","无"!==o[c].subProjectName&&(r+='<li class="dir-item"><a href="javascript:void(0);" class="item-name btn" data-event="editdir" data-parent="'+o[c].subProjectId+'">'+o[c].subProjectName+"</a></li>");t.html(i),e.html(r),n=a.height()+(D-n>0?D-n:20),T=T>n?T:n,P.css("height",T)},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})})})}),P.on("click",function(t){var e=$(t.target),n=e.data("event");switch(n){case"close":P.fadeOut(200),P.html("");break;case"createdir":if(!x){x=!0;var r=e.parents(".create-dir-container"),c=r.find(".create-dir-form"),d=c.find(".form-item"),s=d.find("#_dirname"),l=d.find("#_dirnum"),p=d.find("#_dirparname"),m=s.val(),f=parseInt(l.val()),u=p.find("option:selected"),h=u.val(),g=u.data("parent"),j=u.data("level"),b=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/addSubProject",y={};y={projectid:i,subprojectname:m,sublevel:j,parentid:g,parentName:h},isNaN(f)||(y.subsortid=f),""!==_&&(y.subprojectpassword=_),s.val(""),l.val(""),p.val(""),$.ajax({url:b,type:"POST",dataType:"json",data:y,success:function(t){x=!1;var e=t.result;if(e){var a=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/getAllProject/"+i;$.ajax({url:a,type:"GET",dataType:"json",success:function(o){for(var t=r.find(".form-item").find("#_dirparname"),e=r.find(".exited-dir").find(".dir-list"),a="",i="",n=r.height(),c=0,d=o.length;c<d;c++)a+='<option value="'+o[c].subProjectName+'" data-level="'+o[c].nextLevel+'" data-parent="'+o[c].subProjectId+'">'+o[c].subProjectName+"</option>","无"!==o[c].subProjectName&&(i+='<li class="dir-item"><a href="javascript:void(0);" class="item-name btn" data-event="editdir" data-parent="'+o[c].subProjectId+'">'+o[c].subProjectName+"</a></li>");t.html(a),e.html(i),n=r.height()+(D-n>0?(D-n)/2:20),T=T>n?T:n,P.css("height",T)},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}}),layer.msg("已成功创建目录",{time:1e3},function(){q.push(g),g===-1&&o()})}else layer.msg(t.message,{time:1500})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})}break;case"removepage":var S=(v.data("page"),v.data("project"),v.data("parent")),k=window.location.protocol+"//"+window.location.host+"/ShowDoc/page/deletePageById/"+B+"/"+i;$.ajax({url:k,type:"POST",dataType:"json",success:function(t){P.trigger("click"),v.fadeOut(1),t.result&&(S===-1?o():(q.push(g),w.find(".active").remove())),layer.msg(t.message,{time:1e3})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}});break;case"removeproject":var I=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/deleteProject/"+i;$.ajax({url:I,type:"POST",dataType:"json",success:function(o){o.result?layer.msg("已成功删除项目",{time:1e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/showProject.action"}):layer.msg(o.message,{time:1500},function(){})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}});break;case"removecancel":P.trigger("click");break;case"removeprojectcancel":P.trigger("click");break;case"sharecancel":P.trigger("click");break;case"memberadd":if(!A){A=!0;var N=P.find(".member-manage-container"),C=N.find(".create-member-form"),E=C.find("#_username"),G=E.val(),O=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/addProjectAuthor/"+i;$.ajax({url:O,type:"POST",data:{vname:G},success:function(o){var t=o.trim();if(E.val(""),"success"===t){var e=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/queryProjectAuthor/"+i;$.ajax({url:e,type:"GET",dataType:"json",success:function(o){for(var t="",e=o.length,a=0;a<e;a++)t+='<li class="member-item"><a href="javascript:void(0);" class="btn btn-member" data-event="removemember" data-user="'+o[a].pid+'">'+o[a].vname+"</a></li>";P.find(".member-manage-container").find(".member-list").eq(0).html(t)},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}}),layer.msg("已成功添加项目协作者并保存",{time:1e3},function(){A=!1})}else"fail"===t?layer.msg("对不起！添加失败啦<br/>可能的原因：项目不存在或您没有添加协作者的权限",{time:1500},function(){A=!1}):"illegal"===t?layer.msg("请输入协作者的用户名",{time:1500},function(){A=!1}):layer.msg("该用户名不存在或者已经添加过该用户啦",{tiemout:1500},function(){A=!1})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})}break;case"memberback":P.trigger("click");break;case"removemember":if(!L){L=!0;var M=e.text(),U=e.data("user"),R=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/deleteProjectAuthor/"+U;$.ajax({url:R,type:"POST",data:{vname:M},success:function(o){var t=o.trim();if("success"===t){var e=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/queryProjectAuthor/"+i;$.ajax({url:e,type:"GET",dataType:"json",success:function(o){for(var t="",e=o.length,a=0;a<e;a++)t+='<li class="member-item"><a href="javascript:void(0);" class="btn btn-member" data-event="removemember" data-user="'+o[a].pid+'">'+o[a].vname+"</a></li>";P.find(".member-manage-container").find(".member-list").eq(0).html(t)},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}}),layer.msg("已成功删除项目协作者",{time:1e3},function(){L=!1})}else"fail"===t?layer.msg("对不起！删除失败啦<br/>可能的原因：项目不存在或您没有删除协作者的权限",{time:2e3},function(){L=!1}):layer.msg("该用户名不存在或者已经删除过该用户啦",{tiemout:1500},function(){L=!1})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})}break;case"editdir":var z=P.find(".create-dir-container"),F=e.data("parent"),J=0;z.length<1&&(z=P.find(".edit-dir-container")),J=z.position().top,z.fadeOut(function(){P.load("./tpls/edit-dir.html",function(o,t,e){var a=P.find(".edit-dir-container"),n=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/querySubProjectByID/"+i+"/"+F,r=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/getAllProject/"+i,c=a.find(".edit-dir-form"),d=c.find(".form-item").find("#_dirname"),s=c.find(".form-item").find("#_dirnum"),l=c.find(".form-item").find("#_dirparname");a.attr("data-dirid",F),a.css({opacity:"0",top:J}),$.ajax({url:n,type:"GET",dataType:"json",success:function(o){d.val(o.subprojectname),s.val(o.subsortid);var t=o;a.attr("data-dirparent",t.parentid),a.css("top",J),$.ajax({url:r,type:"GET",dataType:"json",success:function(o){for(var e=a.find(".exited-dir").find(".dir-list"),i="",n="",r=a.height(),c=0,d=o.length;c<d;c++)t.parentid===o[c].subProjectId?i+='<option value="'+o[c].subProjectName+'" data-level="'+o[c].nextLevel+'" data-parent="'+o[c].subProjectId+'" selected="selected">'+o[c].subProjectName+"</option>":o[c].subProjectId!==F&&(i+='<option value="'+o[c].subProjectName+'" data-level="'+o[c].nextLevel+'" data-parent="'+o[c].subProjectId+'">'+o[c].subProjectName+"</option>"),"无"!==o[c].subProjectName&&(n+='<li class="dir-item"><a href="javascript:void(0);" class="item-name btn" data-event="editdir" data-parent="'+o[c].subProjectId+'">'+o[c].subProjectName+"</a></li>");l.html(i),e.html(n),a.animate({opacity:"1"},300,function(){r=a.height()+(D-r>0?(D-r)/2:20),T=T>r?T:r,P.css("height",T)})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})})});break;case"updatedir":if(!H){H=!0;var K=P.find(".edit-dir-container"),Q=K.find(".edit-dir-form"),s=Q.find(".form-item").find("#_dirname"),l=Q.find(".form-item").find("#_dirnum"),p=Q.find(".form-item").find("#_dirparname"),V=p.find("option:selected"),W=s.val(),X=parseInt(l.val()),Y=V.val(),Z=V.data("parent"),oo=V.data("level"),to=K.data("dirid"),eo=K.data("dirparent"),ao=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/updateSubProject",y={},io=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/getAllProject/"+i;y={subprojectid:to,projectid:i,subprojectname:W,sublevel:oo,parentid:Z,parentName:Y},isNaN(X)||(y.subsortid=X),s.val(""),l.val(""),$.ajax({url:ao,type:"POST",data:y,dataType:"json",success:function(t){t.result?(a(io),layer.msg("目录信息已更新并保存",{tiemout:1500},function(){H=!1,Z===-1||eo===-1?o():Z!==-1&&eo!==-1?(q.push(Z),q.push(eo)):Z===-1&&eo!==-1?(o(),q.push(eo)):Z!==-1&&eo===-1&&(o(),q.push(Z))})):layer.msg(t.message,{time:1500},function(){H=!1})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})}break;case"deletedir":if(!isdeletingdir){isdeletingdir=!0;var K=P.find(".edit-dir-container"),F=K.data("dirid"),no=K.data("dirparent"),Q=K.find(".edit-dir-form"),s=Q.find(".form-item").find("#_dirname"),l=Q.find(".form-item").find("#_dirnum"),V=Q.find(".form-item").find("#_dirparname"),ro=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/deleteSubProject/"+i+"/"+F+"/"+no;$.ajax({url:ro,type:"POST",dataType:"json",success:function(t){if(t.result){s.val(""),l.val("");var e=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/getAllProject/"+i;a(e),layer.msg("删除成功",{time:1500},function(){isdeletingdir=!1,no===-1?o():no!==-1&&q.push(no)})}else layer.msg(t.message,{time:1500},function(){isdeletingdir=!1})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})}}t.preventDefault(),t.stopPropagation()}),w.on("click",function(o){var t=$(o.target),a=t.data("type"),n=t.find(".triangle").eq(0);switch(a){case"dir":var r=t.data("parent"),c=t.siblings(".project-list");if(c.length>0&&c.is(":visible")||n.hasClass("top"))return c.slideUp(300),void n.toggleClass("left").css("transition","all 0.3s linear").toggleClass("top").css("transition","");if(c.length>0&&q.indexOf(r)===-1)c.hide().slideDown(300),n.toggleClass("left").css("transition","all 0.3s linear").toggleClass("top").css("transition","");else{var d=q.indexOf(r);d!==-1&&q.splice(d,1),c.remove(),$.ajax({url:G+i+"/"+r,type:"GET",dataType:"json",success:function(o){var e=o.length,a=$("<ul>"),c="";if(a.addClass("project-list"),e>0)for(var d=0;d<e;d++)c+='<li class="dir-item" data-tooltip="目录：'+o[d].subprojectname+'"><a href="javascript:void(0);" class="btn btn-dir" data-type="dir" data-parent="'+o[d].subprojectid+'"><span class="triangle left"></span>'+o[d].subprojectname+"</a></li>";$.ajax({url:O+r+"/"+i,type:"GET",dataType:"json",success:function(o){for(var e=o.length,i=0;i<e;i++)c+='<li class="page-item" data-tooltip="page：'+o[i].pagetitle+'"><a href="javascript:void(0);" class="btn btn-page" data-type="page" data-page="'+o[i].pageid+'" data-parent="'+r+'">'+o[i].pagetitle+"</a></li>";a.html(c).hide(),t.after(a),a.slideDown(300),n.toggleClass("left").css("transition","all 0.3s linear").toggleClass("top").css("transition","")},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})}break;case"page":var s=t.data("page"),l=(t.data("parent"),window.location.protocol+"//"+window.location.host+"/ShowDoc/page/selectPageById/"+s+"/"+i);B=s,t.hasClass("active")||($(this).find(".btn-page").removeClass("active"),t.removeClass("hover").addClass("active"),e(l))}o.preventDefault(),o.stopPropagation()}),w.on("mouseover",function(o){var t=$(o.target),e=t.data("type");"page"!==e||t.hasClass("hover")||t.hasClass("active")||t.addClass("hover"),t.parent().addClass("hover")}).on("mouseout",function(o){var t=$(o.target),e=t.data("type");"page"===e&&t.hasClass("hover")&&t.removeClass("hover"),t.parent().removeClass("hover")}),m.on("click",function(o){var e=$(o.target),a=e.data("role");switch(a){case"share":t();break;case"copy":var n=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/editproject.jsp?projectid="+i+"&projectname="+C+"&check="+_+"&pageid="+B+"&type=copy";window.location.href=n;break;case"edit":var n=window.location.protocol+"//"+window.location.host+"/ShowDoc/jsp/project/editproject.jsp?projectid="+i+"&projectname="+C+"&check="+_+"&pageid="+B+"&type=edit";window.location.href=n;break;case"remove":k=$(document).height(),T=D>k?D:k,P.css("height",T).fadeIn(200),P.load("./tpls/remove-page.html",function(o,t,e){var a=P.find(".remove-page-container"),i=a.height(),n=(D-i)/2;n=n>0?n:20,a.css("top",-i).animate({opacity:"1",top:n},200,function(){a.animate({top:n-30},200,function(){a.animate({top:n},200)})})})}o.preventDefault(),o.stopPropagation()}),s.hover(function(o){S||(l.addClass("hover"),p.fadeIn(100).css("top","25px").animate({top:"35px"},300,function(){S=!1})),o.preventDefault(),o.stopPropagation()},function(o){l.removeClass("hover"),p.fadeOut(200),o.preventDefault(),o.stopPropagation()}),s.on("click",function(o){var e=$(o.target),a=e.data("item");switch(a){case"share":t();break;case"member":k=$(document).height(),T=D>k?D:k,P.css("height",T).fadeIn(200),P.load("./tpls/member-manage.html",function(o,t,e){var a=P.find(".member-manage-container"),n=a.find(".member-list").eq(0),r=a.height(),c=(D-r)/2,d=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/queryProjectAuthor/"+i;c=c>0?c:20,$.ajax({url:d,type:"GET",dataType:"json",success:function(o){for(var t="",e=o.length,i=0;i<e;i++)t+='<li class="member-item"><a href="javascript:void(0);" class="btn btn-member" data-event="removemember" data-user="'+o[i].pid+'">'+o[i].vname+"</a></li>";n.html(t),r=a.height(),c=(D-r)/2,c=c>0?c:20,a.css("top",-r).animate({opacity:"1",top:c},200,function(){a.animate({top:c-30},200,function(){a.animate({top:c},200)})})},error:function(o){layer.msg("登录信息失效，请返回首页重新登录",{time:2e3},function(){window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc"})}})});break;case"delete":k=$(document).height(),T=D>k?D:k,P.css("height",T).fadeIn(200),P.load("./tpls/remove-project.html",function(o,t,e){var a=P.find(".remove-project-container"),i=a.height(),n=(D-i)/2;n=n>0?n:20,a.css("top",-i).animate({opacity:"1",top:n},200,function(){a.animate({top:n-30},200,function(){a.animate({top:n},200)})})})}o.preventDefault(),o.stopPropagation()})});