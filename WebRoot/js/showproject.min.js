$(function(){function t(){$.ajax({url:E+n+"/-1",type:"GET",dataType:"json",success:function(t){for(var e="",n=t.length,o=0;o<n;o++)e+='<li class="dir-item"><a href="javascript:void(0);" class="btn btn-dir" data-type="dir" data-parent="'+t[o].subprojectid+'"><span class="triangle left"></span>'+t[o].subprojectname+"</a></li>";f.html(e)},error:function(t){console.log(t)}})}for(var e,n,o=$("body"),i=o.find("#header"),a=i.find(".common-middle").find(".middle-title"),s=i.find(".common-right").eq(0),c=s.find(".btn-manage"),r=i.find(".feature-list"),l=o.find("#main"),d=l.find(".sideNav"),f=d.find("#project-nav").find("#project-list"),p=d.find(".add-page-item").find(".btn"),u=d.find(".add-dir-item").find(".btn"),m=d.find("#project-nav"),g=(m.find(".btn-dir"),m.find(".btn-page")),h=l.find(".show-content"),v=h.find(".content-operations"),b=v.find(".btn-share"),j=v.find(".btn-copy"),w=v.find(".btn-edit"),k=v.find(".btn-remove"),y=h.find(".content-title").find(".title"),P=h.find("#markdown-content"),x=o.find("#mask"),C=!1,T=$(window).height(),D=$(document).height(),N=T>D?T:D,S=!1,I=window.location,O=decodeURI(I.search),_="",q="",E=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/querySubProject/",G=[],L=O.replace(/\?\s*/g,"").split("&"),U=0,A=L.length;U<A;U++){var H=L[U].split("=");"id"===H[0]&&(n=H[1]||""),"projectname"===H[0]&&(_=H[1]||""),"check"===H[0]&&(q=H[1]||"")}a.text(_),t(),e=editormd("test-editormd",{width:0,height:0,path:"../lib/",htmlDecode:"style,script,iframe"}),p.on("click",function(){}),u.on("click",function(){D=$(document).height(),N=T>D?T:D,x.css("height",N).fadeIn(200),x.load("tpls/create-dir.html",function(t,e,o){var i=x.find(".create-dir-container"),a=i.height(),s=(T-a)/2;s=s>0?s:20,i.css("top",-a).animate({top:s,opacity:1},200,function(){var t=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/getAllProject/"+n;$.ajax({url:t,type:"GET",dataType:"json",success:function(t){for(var e=i.find(".form-item").find("#_dirparname"),n=i.find(".exited-dir").find(".dir-list"),o="",s="",c=0,r=t.length;c<r;c++)o+='<option value="'+t[c].subProjectName+'" data-level="'+t[c].nextLevel+'" data-parent="'+t[c].subProjectId+'">'+t[c].subProjectName+"</option>","无"!==t[c].subProjectName&&(s+='<li class="dir-item"><span class="item-name">'+t[c].subProjectName+"</span></li>");e.html(o),n.html(s),a=i.height()+(T-a>0?T-a:20)+20,N=N>a?N:a,x.css("height",N)},error:function(t){console.log(t)}})})})}),x.on("click",function(e){var o=$(e.target),i=o.data("event");switch(i){case"close":x.fadeOut(200),x.html("");break;case"createdir":if(!S){S=!0;var a=o.parents(".create-dir-container"),s=a.find(".create-dir-form"),c=s.find(".form-item"),r=c.find("#_dirname"),l=c.find("#_dirnum"),d=c.find("#_dirparname"),f=r.val(),p=parseInt(l.val()),u=d.find("option:selected"),m=u.val(),g=u.data("parent"),h=u.data("level"),v=window.location.protocol+"//"+window.location.host+"/ShowDoc/subProject/addSubProject",b={};b={projectid:n,subprojectname:f,sublevel:h,parentid:g,parentName:m},isNaN(p)||(b.subsortid=p),""!==q&&(b.subprojectpassword=q),$.ajax({url:v,type:"POST",dataType:"json",data:b,success:function(e){S=!1;var n=e.result;n?layer.msg("已成功创建目录",{time:3e3},function(){x.trigger("click"),G.push(g),g===-1&&(console.log("初始化操作"),t())}):layer.msg(e.message,{time:3e3})},error:function(t){console.log(t)}})}}e.preventDefault(),e.stopPropagation()}),f.on("click",function(t){var e=$(t.target),o=e.data("type"),i=e.find(".triangle").eq(0);switch(o){case"dir":var a=e.data("parent"),s=e.siblings(".project-list");if(s.length>0&&s.is(":visible")||i.hasClass("top"))return s.slideUp(300),void i.toggleClass("left").css("transition","all 0.3s linear").toggleClass("top").css("transition","");if(s.length>0&&G.indexOf(a)===-1)s.hide().slideDown(300),i.toggleClass("left").css("transition","all 0.3s linear").toggleClass("top").css("transition","");else{var c=G.indexOf(a);c!==-1&&G.splice(c,1),s.remove(),$.ajax({url:E+n+"/"+a,type:"GET",dataType:"json",success:function(t){var n=t.length,o=$("<ul>"),a="";if(o.addClass("project-list"),n>0){for(var s=0;s<n;s++)a+='<li class="dir-item"><a href="javascript:void(0);" class="btn btn-dir" data-type="dir" data-parent="'+t[s].subprojectid+'"><span class="triangle left"></span>'+t[s].subprojectname+"</a></li>";o.html(a).hide(),e.after(o),o.slideDown(300)}i.toggleClass("left").css("transition","all 0.3s linear").toggleClass("top").css("transition","")},error:function(t){console.log(t)}})}break;case"page":console.log("处理page事件")}}),g.on("click",function(){h.show(),y.text($(this).text()),$.get("./tpls/api.md",function(t){P.html(""),window.editormd.markdownToHTML("markdown-content",{markdown:t})})}),b.on("click",function(){console.log("share")}),j.on("click",function(){console.log("copy")}),w.on("click",function(){console.log("edit")}),k.on("click",function(){console.log("remove")}),c.on("click",function(){console.log(r)}),s.hover(function(t){C||(c.addClass("hover"),r.fadeIn(100).css("top","25px").animate({top:"35px"},300,function(){C=!1})),t.preventDefault(),t.stopPropagation()},function(t){c.removeClass("hover"),r.fadeOut(200),t.preventDefault(),t.stopPropagation()}),s.on("click",function(t){var e=$(t.target),n=e.data("item");switch(n){case"share":console.log("分享");break;case"modify":console.log("修改");break;case"member":console.log("成员");break;case"transfer":console.log("转让");break;case"delete":console.log("删除")}})});