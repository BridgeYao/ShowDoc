$(function(){var i=$("#header"),o=i.find("#user-center"),n=o.find(".user-portraint").eq(0),e=i.find(".sub-nav").eq(0),t=e.find(".sub-btn"),a=$("#mask-container"),r=a.find("#person-info"),s=r.find(".btn-back"),d=a.find("#modify-person-password"),l=(d.find(".btn-submit"),d.find(".btn-cancel")),c=a.find("#modify-person-info"),f=(c.find(".btn-submit"),c.find(".btn-cancel")),u=!1,h=$("body").children(".modify-info-result").text().trim(),p=$("#main"),m=p.find(".project-list"),v=m.find(".project-item").find(".project-btn");if("success"===h){var w=$("<div>"),g="<span>已经保存成功</span>";w.html(g).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#58f69e",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){w.fadeOut(300),document.body.removeChild(w[0])},700)})}o.hover(function(i){u||(u=!0,e.show(100))},function(i){e.hide(100,function(){u=!1})}),n.hover(function(){$(this).addClass("rotate")},function(){$(this).removeClass("rotate")}),t.on("click",function(){var i=$(this).data("dist");if(e.hide(),void 0!==i){var o=$("#"+i),n=$(window).height();if("person-info"===i){var t=o.data("user"),r=o.find(".item-name-content"),s=o.find(".item-email-content"),d=o.find(".item-portraint-content"),l=o.find(".info-item-skill"),c=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+t;$.ajax({url:c,type:"GET",dataType:"json",success:function(i){r.text(i.voucher.username),s.text(i.voucherInfo.email);var o=i.voucherInfo.skill,n="";if(null===o)n='<span class="item-skill-title">编程技能</span><span class="item-skill-other">无</span>',l.html(n);else{var e=o.split("-"),t="",a=$('<ul class="item-skill-list">');$.each(e,function(i,o){t=t+'<li class="item-skill-item"><span class="item-skill-content">'+o+"</span></li>"}),a.html(t),n='<span class="item-skill-title">编程技能</span>',l.html(n),l.append(a)}var c=$("<img />"),f=window.location.protocol+"//"+window.location.host+i.voucherInfo.picture;c.on("load",function(){d.attr("src",f).hover(function(){d.addClass("rotate")},function(){d.removeClass("rotate")})}),c.attr("src",f)}})}else if("modify-person-info"===i){var f=o.data("user"),u=o.find("#update-info-form"),h=o.find("#modify-info-username"),p=o.find("#modify-info-email"),m=o.find(".modify-info-portraint"),v=m.find(".item-upimg-name"),w=m.find(".item-img-result"),g=m.find("#modify-picture"),y=m.find(".valid-error"),b=o.find(".modify-info-skill").find("#modify-skill").find("option"),k=o.find(".modify-form-operations").find(".btn-submit"),x=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+f;w.hide().siblings().show(),$.ajax({url:x,type:"GET",dataType:"json",success:function(i){h.val(i.voucher.username),p.val(i.voucherInfo.email);var n=$("<img />"),e=window.location.protocol+"//"+window.location.host+i.voucherInfo.picture;n.on("load",function(){w.attr("src",e).show().siblings().hide()}),n.attr("src",e);var t=i.voucherInfo.skill;if(null!=t){var a=t.split("-");b.each(function(){var i=this;$.each(a,function(o,n){return $(i).val()===n?void $(i).attr("selected","selected"):void 0})})}o.find(".modify-info-skill").find(".SlectBox").SumoSelect({csvDispCount:12,forceCustomRendering:!0,search:!0}),$.validator.addMethod("isImage",function(i,o){return this.optional(o)||/\w*.jpg|\w*.png|\w*.gif/.test(i)},"只能上传图片"),$.validator.addMethod("isToLarge",function(i,o){var n=o.files[0];return this.optional(o)||n.size/1024<3072},"文件大小不能超过3M"),u.validate({rules:{email:{required:!0,email:!0},picture:{isImage:!0,isToLarge:!0}},messages:{email:{required:"邮箱不能为空",email:"邮箱格式不合格"},picture:{isImage:"只能上传图片",isToLarge:"文件大小不能超过3M"}},errorElement:"p",errorContainer:!0,errorClass:"valid-error",validClass:"valid-pass"}),g.on("change",function(){var i=this.files[0];if(v.html(i.name),u.validate().element(this),!u.validate().element(this))return void g.blur();var o=new FileReader;o.readAsDataURL(i),o.onload=function(i){$(".item-img-result").attr("src",this.result).show(),$(".item-show-title").hide(),y.text("").hide()}}),k.on("click",function(){return u.valid()&&(console.log("submit"),o.find("#update-info-form").submit()),!1})}})}else if("modify-person-password"===i){var T=o.data("user"),C=o.find("#update-password-form"),j=C.find(".update-form-operations").find(".btn-submit"),q=o.find("#update-old-password"),I=o.find("#update-new-password"),S=C.find("#update-username"),P=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+T;o.find(".modify-restul-info").hide(),q.val(""),I.val(""),C.find("#update-new-password-again").val(""),$.ajax({url:P,type:"POST",dataType:"json",success:function(i){S.val(i.voucher.username)}}),C.validate({rules:{password:{required:!0,rangelength:[6,40]},newPassword:{required:!0,rangelength:[6,40]},newPasswordAgain:{required:!0,rangelength:[6,40],equalTo:"#update-new-password"}},messages:{password:{required:"未输入原密码",rangelength:"密码长度为6-40位"},newPassword:{required:"未输入新密码",rangelength:"密码长度为6-40位"},newPasswordAgain:{required:"未输入确认密码",rangelength:"密码长度为6-40位",equalTo:"两次输入的密码不一致"}},errorElement:"p",errorContainer:!0,errorClass:"valid-error",validClass:"valid-pass"});var D=!1;j.on("click",function(){if(!D){D=!0;var i=q.val(),n=I.val(),e=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/updatePassword.action?id="+T+"&username="+S.val()+"&password="+i+"&newPassword="+n;C.valid()&&$.ajax({url:e,type:"POST",dataType:"text",success:function(i){var n=i.trim();if(D=!1,"success"===n){o.hide(),a.hide();var e=$("<div>"),t="<span>已经保存成功</span>";e.html(t).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#58f69e",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){e.fadeOut(300),document.body.removeChild(e[0])},700)})}else if("fail"===n){var r=o.find(".modify-restul-info");r.html("账号和原始密码不匹配").show()}else if("illegal"===n){var r=o.find(".modify-restul-info");r.html("密码的格式不正确").show()}}})}return!1})}a.show(100,function(){o.css("top","-100%").show();var i=o.height();o.animate({top:(n-i)/2},function(){o.siblings().hide()})})}}),s.on("click",function(){a.hide(function(){a.children().hide()})}),f.on("click",function(){a.hide(function(){a.children().hide()})}),l.on("click",function(){a.hide(function(){a.children().hide()})}),a.on("click",function(i){i.target===this&&a.hide().children().hide()}),v.on("click",function(){var i=$("body"),o=i.height(),n=$(window).height(),e=n-o,t=$("#create-project-container"),a=t.find("#create-project-form"),r=0,s=a.find(".project-form-operations").find(".btn-submit"),d=a.find(".project-form-operations").find(".btn-cancel");return t.css("bottom",e).show(100,function(){a.css({opacity:"0",top:"-100%"}).show(),r=a.height(),a.animate({top:n/2-r/2,opacity:"1"},100)}).on("click",function(i){i.target===this&&$(this).hide(function(){a.hide()})}),d.on("click",function(){return t.trigger("click"),!1}),s.on("click",function(){return!1}),!1})});