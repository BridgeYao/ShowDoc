$(function(){var o=$("#header"),i=o.find("#user-center"),e=i.find(".user-portraint").eq(0),n=o.find(".sub-nav").eq(0),t=n.find(".sub-btn"),a=o.find("#user-exit").find(".btn-exit"),r=$("#mask-container"),s=r.find("#person-info"),c=s.find(".btn-back"),d=r.find("#modify-person-password"),l=(d.find(".btn-submit"),d.find(".btn-cancel")),f=r.find("#modify-person-info"),u=(f.find(".btn-submit"),f.find(".btn-cancel")),h=!1,m=$("body").children(".modify-info-result").text().trim(),p=$("#main"),w=p.find(".project-list"),v=(w.find(".project-item").find(".btn-detail"),w.find(".project-item-add").find(".project-btn"));"success"===m&&(window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/showProject.action",layer.msg("个人信息修改成功并保存",{time:1e3},function(){})),a.on("click",function(o){var i=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/exitVoucher.action";window.location.href=i,o.stopPropagation(),o.preventDefault()}),i.hover(function(o){h||(h=!0,n.show(100))},function(o){n.hide(100,function(){h=!1})}),e.hover(function(){$(this).addClass("rotate")},function(){$(this).removeClass("rotate")}),t.on("click",function(){var o=$(this).data("dist"),i=$(window).height(),e=$(document).height(),t=i-(e+30);if(t=t>0?0:t,n.hide(),void 0!==o){var a=$("#"+o),i=$(window).height();if("person-info"===o){var s=a.data("user"),c=a.find(".item-name-content"),d=a.find(".item-email-content"),l=a.find(".item-portraint-content"),f=a.find(".info-item-skill"),u=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+s;$.ajax({url:u,type:"GET",dataType:"json",success:function(o){c.text(o.voucher.username),d.text(o.voucherInfo.email);var i=o.voucherInfo.skill,e="";if(null===i)e='<span class="item-skill-title">编程技能</span><span class="item-skill-other">无</span>',f.html(e);else{var n=i.split("-"),t="",a=$('<ul class="item-skill-list">');$.each(n,function(o,i){t=t+'<li class="item-skill-item"><span class="item-skill-content">'+i+"</span></li>"}),a.html(t),e='<span class="item-skill-title">编程技能</span>',f.html(e),f.append(a)}var r=$("<img />"),s=window.location.protocol+"//"+window.location.host+o.voucherInfo.picture;r.on("load",function(){l.attr("src",s).hover(function(){l.addClass("rotate")},function(){l.removeClass("rotate")})}),r.attr("src",s)}})}else if("modify-person-info"===o){var h=a.data("user"),m=a.find("#update-info-form"),p=a.find("#modify-info-username"),w=a.find("#modify-info-email"),v=a.find(".modify-info-portraint"),g=v.find(".item-upimg-name"),y=v.find(".item-img-result"),b=v.find("#modify-picture"),j=v.find(".valid-error"),k=a.find(".modify-info-skill").find("#modify-skill").find("option"),x=a.find(".modify-form-operations").find(".btn-submit"),T=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+h;y.hide().siblings().show(),$.validator.addMethod("isImage",function(o,i){return this.optional(i)||/\w*.jpg|\w*.png|\w*.gif/.test(o)},"只能上传图片"),$.validator.addMethod("isToLarge",function(o,i){var e=i.files[0];return this.optional(i)||e.size/1024<3072},"文件大小不能超过3M");var S=m.validate({rules:{email:{required:!0,email:!0},picture:{isImage:!0,isToLarge:!0}},messages:{email:{required:"邮箱不能为空",email:"邮箱格式不合格"},picture:{isImage:"只能上传图片",isToLarge:"文件大小不能超过3M"}},errorElement:"p",errorContainer:!0,errorClass:"valid-error",validClass:"valid-pass"});S.resetForm(),$.ajax({url:T,type:"GET",dataType:"json",success:function(o){p.val(o.voucher.username),w.val(o.voucherInfo.email);var i=$("<img />"),e=window.location.protocol+"//"+window.location.host+o.voucherInfo.picture;i.on("load",function(){y.attr("src",e).show().siblings().hide()}),i.attr("src",e);var n=o.voucherInfo.skill;if(null!=n){var t=n.split("-");k.each(function(){var o=this;$.each(t,function(i,e){if($(o).val()===e)return void $(o).attr("selected","selected")})})}a.find(".modify-info-skill").find(".SlectBox").SumoSelect({csvDispCount:12,forceCustomRendering:!0,search:!0}),b.on("change",function(){var o=this.files[0];if(g.html(o.name),m.validate().element(this),!m.validate().element(this))return void b.blur();var i=new FileReader;i.readAsDataURL(o),i.onload=function(o){$(".item-img-result").attr("src",this.result).show(),$(".item-show-title").hide(),j.text("").hide()}}),x.on("click",function(){return m.valid()&&a.find("#update-info-form").submit(),!1})}})}else if("modify-person-password"===o){var P=a.data("user"),q=a.find("#update-password-form"),C=q.find(".update-form-operations").find(".btn-submit"),D=a.find("#update-old-password"),I=a.find("#update-new-password"),O=q.find("#update-username"),V=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+P;a.find(".modify-restul-info").hide(),D.val(""),I.val(""),q.find("#update-new-password-again").val("");var B=q.validate({rules:{password:{required:!0,rangelength:[6,40]},newPassword:{required:!0,rangelength:[6,40]},newPasswordAgain:{required:!0,rangelength:[6,40],equalTo:"#update-new-password"}},messages:{password:{required:"未输入原密码",rangelength:"密码长度为6-40位"},newPassword:{required:"未输入新密码",rangelength:"密码长度为6-40位"},newPasswordAgain:{required:"未输入确认密码",rangelength:"密码长度为6-40位",equalTo:"两次输入的密码不一致"}},errorElement:"p",errorContainer:!0,errorClass:"valid-error",validClass:"valid-pass"});B.resetForm(),$.ajax({url:V,type:"POST",dataType:"json",success:function(o){O.val(o.voucher.username)}});var E=!1;C.on("click",function(){if(!E){E=!0;var o=D.val(),i=I.val(),e=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/updatePassword.action?id="+P+"&username="+O.val()+"&password="+o+"&newPassword="+i;q.valid()&&$.ajax({url:e,type:"POST",dataType:"text",success:function(o){var i=o.trim();E=!1,"success"===i?layer.msg("修改成功并保存",{time:1e3},function(){a.fadeOut(),r.fadeOut()}):"fail"===i?layer.msg("账号和原始密码不匹配",{time:1500}):"illegal"===i&&layer.msg("密码的格式不正确",{time:1500})}})}return!1})}r.css("bottom",t).show(100,function(){a.css("top","-100%").show();var n=a.height(),s=(i-n)/2;"modify-person-info"===o&&a.find(".modify-info-skill").find(".CaptionCont").on("click",function(){n+=a.find(".modify-info-skill").find(".optWrapper").height(),e=e>n?e:n,t=i-(e+30),t=t>0?0:t,r.css("bottom",t)}),s=s>10?s:10,e=e>n?e:n,t=i-(e+30),t=t>0?0:t,r.css("bottom",t),a.animate({top:s},function(){a.siblings().hide()})})}}),c.on("click",function(){r.hide(function(){r.children().fadeOut(200)})}),u.on("click",function(){r.hide(function(){r.children().fadeOut(200)})}),l.on("click",function(){r.hide(function(){r.children().fadeOut(200)})}),r.on("click",function(o){o.target===this&&r.fadeOut(200).children().hide()}),v.on("click",function(){var o=$("body"),i=(o.height(),$(window).height()),e=$(document).height(),n=0,t=$("#create-project-container"),a=t.find("#create-project-form"),r=0,s=a.find(".project-form-operations").find(".btn-submit"),c=a.find(".project-form-operations").find(".btn-cancel"),d=0;$(document).scrollTop(10),setTimeout(function(){t.css("bottom",n).show(100,function(){a.css({opacity:"0",top:"-100%"}).show(),r=a.outerHeight(),d=i/2-r/2,d=d>20?d:10,r+=20,e=e>r?e:r,n=i-e,n=n>0?0:n,t.css("bottom",n),a.animate({top:d,opacity:"1"},100)}).on("click",function(o){o.target===this&&$(this).hide(function(){a.hide()})})},100),a.find(".projectname").on("blur",function(o){var i=$(this).val(),e=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/checkProject/"+i;$.ajax({url:e,type:"POST",dataType:"text",success:function(o){var i=o.trim();"success"===i||("fail"===i?layer.msg("项目名已存在",{time:1500}):"illegal"===i&&layer.msg("项目名格式错误",{time:1500}))}}),o.preventDefault(),o.stopPropagation()}),c.on("click",function(){return t.trigger("click"),!1});var l=!1;return s.on("click",function(){if(!l){l=!0;var o=a.find(".projectname"),i=a.find(".projectdesc"),e=a.find(".sortid"),n=a.find(".username"),t=a.find(".password"),r=o.val(),s=i.val(),c=e.val(),d=n.val(),f=t.val(),u=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/addProject?projectname="+r+"&projectdesc="+s+"&sortid="+c+"&authorname="+d+"&projectpassword="+f;$.ajax({url:u,type:"POST",dataType:"text",success:function(o){var i=o.trim();if(res=i.split(","),"success"===res[0])layer.msg("项目已创建成功",{time:1e3},function(){l=!1,window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/showProject.action"});else if("fail"===res[0])layer.msg("项目创建时出错",{time:1500},function(){l=!1});else if("illegal"===res[0])layer.msg(res[1],{time:1500},function(){l=!1});else{var e=o.replace(/\s/,""),n=e.indexOf('<h3 class="error-info">')+'<h3 class="error-info">'.length,t=e.lastIndexOf("</h3>"),a=e.substring(n,t),r=window.location.protocol+"//"+window.location.host+"/ShowDoc/",s=r+"exception/operateVoucherHandle.action?message="+a;window.location.href=s}}})}return!1}),!1})});