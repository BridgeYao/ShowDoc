$(function(){var i=$("#header"),e=i.find("#user-center"),n=e.find(".user-portraint").eq(0),o=i.find(".sub-nav").eq(0),t=o.find(".sub-btn"),a=$("#mask-container"),r=a.find("#person-info"),s=r.find(".btn-back"),d=a.find("#modify-person-password"),l=(d.find(".btn-submit"),d.find(".btn-cancel")),c=a.find("#modify-person-info"),f=(c.find(".btn-submit"),c.find(".btn-cancel")),u=!1;e.hover(function(i){u||(u=!0,o.show(100))},function(i){o.hide(100,function(){u=!1})}),n.hover(function(){$(this).addClass("rotate")},function(){$(this).removeClass("rotate")}),t.on("click",function(){var i=$(this).data("dist");if(o.hide(),void 0!==i){var e=$("#"+i),n=$(window).height();if("person-info"===i){var t=e.data("user"),r=e.find(".item-name-content"),s=e.find(".item-email-content"),d=e.find(".item-portraint-content"),l=e.find(".info-item-skill"),c=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+t;$.ajax({url:c,type:"GET",dataType:"json",success:function(i){r.text(i.voucher.username),s.text(i.voucherInfo.email);var e=i.voucherInfo.skill,n="";if(null===e)n='<span class="item-skill-title">编程技能</span><span class="item-skill-other">无</span>',l.html(n);else{var o=e.split("-"),t="",a=$('<ul class="item-skill-list">');$.each(o,function(i,e){t=t+'<li class="item-skill-item"><span class="item-skill-content">'+e+"</span></li>"}),a.html(t),n='<span class="item-skill-title">编程技能</span>',l.html(n),l.append(a)}var c=$("<img />"),f=window.location.protocol+"//"+window.location.host+i.voucherInfo.picture;c.on("load",function(){d.attr("src",f).hover(function(){d.addClass("rotate")},function(){d.removeClass("rotate")})}),c.attr("src",f)}})}else if("modify-person-info"===i){var f=e.data("user"),u=e.find("#update-info-form"),h=e.find("#modify-info-username"),m=e.find("#modify-info-email"),p=e.find(".modify-info-portraint"),v=p.find(".item-upimg-name"),w=p.find(".item-img-result"),g=p.find("#modify-picture"),y=p.find(".valid-error"),b=e.find(".modify-info-skill").find("#modify-skill").find("option"),k=e.find(".modify-form-operations").find(".btn-submit"),q=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+f;w.hide().siblings().show(),$.ajax({url:q,type:"GET",dataType:"json",success:function(i){h.val(i.voucher.username),m.val(i.voucherInfo.email);var n=$("<img />"),o=window.location.protocol+"//"+window.location.host+i.voucherInfo.picture;n.on("load",function(){w.attr("src",o).show().siblings().hide()}),n.attr("src",o);var t=i.voucherInfo.skill;if(null!=t){var a=t.split("-");b.each(function(){var i=this;$.each(a,function(e,n){return $(i).val()===n?void $(i).attr("selected","selected"):void 0})})}e.find(".modify-info-skill").find(".SlectBox").SumoSelect({csvDispCount:12,forceCustomRendering:!0,search:!0}),$.validator.addMethod("isImage",function(i,e){return this.optional(e)||/\w*.jpg|\w*.png|\w*.gif/.test(i)},"只能上传图片"),$.validator.addMethod("isToLarge",function(i,e){var n=e.files[0];return this.optional(e)||n.size/1024<3072},"文件大小不能超过3M"),u.validate({rules:{email:{required:!0,email:!0},picture:{isImage:!0,isToLarge:!0}},messages:{email:{required:"邮箱不能为空",email:"邮箱格式不合格"},picture:{isImage:"只能上传图片",isToLarge:"文件大小不能超过3M"}},errorElement:"p",errorContainer:!0,errorClass:"valid-error",validClass:"valid-pass"}),g.on("change",function(){var i=this.files[0];if(v.html(i.name),u.validate().element(this),!u.validate().element(this))return void g.blur();var e=new FileReader;e.readAsDataURL(i),e.onload=function(i){$(".item-img-result").attr("src",this.result).show(),$(".item-show-title").hide(),y.text("").hide()}}),k.on("click",function(){return u.valid()&&(console.log("submit"),e.find("#update-info-form").submit()),!1})}})}else if("modify-person-password"===i){var T=e.data("user"),C=e.find("#update-password-form"),x=C.find(".update-form-operations").find(".btn-submit"),I=e.find("#update-old-password"),S=e.find("#update-new-password"),j=C.find("#update-username"),P=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+T;e.find(".modify-restul-info").hide(),I.val(""),S.val(""),C.find("#update-new-password-again").val(""),$.ajax({url:P,type:"POST",dataType:"json",success:function(i){j.val(i.voucher.username)}}),C.validate({rules:{password:{required:!0,rangelength:[6,40]},newPassword:{required:!0,rangelength:[6,40]},newPasswordAgain:{required:!0,rangelength:[6,40],equalTo:"#update-new-password"}},messages:{password:{required:"未输入原密码",rangelength:"密码长度为6-40位"},newPassword:{required:"未输入新密码",rangelength:"密码长度为6-40位"},newPasswordAgain:{required:"未输入确认密码",rangelength:"密码长度为6-40位",equalTo:"两次输入的密码不一致"}},errorElement:"p",errorContainer:!0,errorClass:"valid-error",validClass:"valid-pass"});var D=!1;x.on("click",function(){if(!D){D=!0;var i=I.val(),n=S.val(),o=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/updatePassword.action?id="+T+"&username="+j.val()+"&password="+i+"&newPassword="+n;C.valid()&&$.ajax({url:o,type:"POST",dataType:"text",success:function(i){var n=i.trim();if(D=!1,"success"===n){e.hide(),a.hide();var o=$("<div>"),t="<span>已经保存成功</span>";o.html(t).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#58f69e",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){o.fadeOut(300),document.body.removeChild(o[0])},700)})}else if("fail"===n){var r=e.find(".modify-restul-info");r.html("账号和原始密码不匹配").show()}else if("illegal"===n){var r=e.find(".modify-restul-info");r.html("密码的格式不正确").show()}}})}return!1})}a.show(100,function(){e.css("top","-100%").show();var i=e.height();e.animate({top:(n-i)/2},function(){e.siblings().hide()})})}}),s.on("click",function(){a.hide(function(){a.children().hide()})}),f.on("click",function(){a.hide(function(){a.children().hide()})}),l.on("click",function(){a.hide(function(){a.children().hide()})}),a.on("click",function(i){i.target===this&&a.hide().children().hide()})});