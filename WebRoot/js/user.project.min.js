$(function(){var o=$("#header"),i=o.find("#user-center"),n=i.find(".user-portraint").eq(0),e=o.find(".sub-nav").eq(0),t=e.find(".sub-btn"),a=$("#mask-container"),r=a.find("#person-info"),s=r.find(".btn-back"),d=a.find("#modify-person-password"),l=(d.find(".btn-submit"),d.find(".btn-cancel")),c=a.find("#modify-person-info"),f=(c.find(".btn-submit"),c.find(".btn-cancel")),u=!1,p=$("body").children(".modify-info-result").text().trim(),h=$("#main"),m=h.find(".project-list"),v=m.find(".project-item").find(".btn-detail"),w=m.find(".project-item-add").find(".project-btn");if("success"===p){var g=$("<div>"),b="<span>已经保存成功</span>";g.html(b).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#58f69e",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){g.fadeOut(300),document.body.removeChild(g[0])},700)})}i.hover(function(o){u||(u=!0,e.show(100))},function(o){e.hide(100,function(){u=!1})}),n.hover(function(){$(this).addClass("rotate")},function(){$(this).removeClass("rotate")}),t.on("click",function(){var o=$(this).data("dist"),i=$(window).height(),n=$(document).height(),t=i-(n+30);if(t=t>0?0:t,e.hide(),void 0!==o){var r=$("#"+o),i=$(window).height();if("person-info"===o){var s=r.data("user"),d=r.find(".item-name-content"),l=r.find(".item-email-content"),c=r.find(".item-portraint-content"),f=r.find(".info-item-skill"),u=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+s;$.ajax({url:u,type:"GET",dataType:"json",success:function(o){d.text(o.voucher.username),l.text(o.voucherInfo.email);var i=o.voucherInfo.skill,n="";if(null===i)n='<span class="item-skill-title">编程技能</span><span class="item-skill-other">无</span>',f.html(n);else{var e=i.split("-"),t="",a=$('<ul class="item-skill-list">');$.each(e,function(o,i){t=t+'<li class="item-skill-item"><span class="item-skill-content">'+i+"</span></li>"}),a.html(t),n='<span class="item-skill-title">编程技能</span>',f.html(n),f.append(a)}var r=$("<img />"),s=window.location.protocol+"//"+window.location.host+o.voucherInfo.picture;r.on("load",function(){c.attr("src",s).hover(function(){c.addClass("rotate")},function(){c.removeClass("rotate")})}),r.attr("src",s)}})}else if("modify-person-info"===o){var p=r.data("user"),h=r.find("#update-info-form"),m=r.find("#modify-info-username"),v=r.find("#modify-info-email"),w=r.find(".modify-info-portraint"),g=w.find(".item-upimg-name"),b=w.find(".item-img-result"),y=w.find("#modify-picture"),k=w.find(".valid-error"),x=r.find(".modify-info-skill").find("#modify-skill").find("option"),T=r.find(".modify-form-operations").find(".btn-submit"),j=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+p;b.hide().siblings().show(),$.ajax({url:j,type:"GET",dataType:"json",success:function(o){m.val(o.voucher.username),v.val(o.voucherInfo.email);var i=$("<img />"),n=window.location.protocol+"//"+window.location.host+o.voucherInfo.picture;i.on("load",function(){b.attr("src",n).show().siblings().hide()}),i.attr("src",n);var e=o.voucherInfo.skill;if(null!=e){var t=e.split("-");x.each(function(){var o=this;$.each(t,function(i,n){return $(o).val()===n?void $(o).attr("selected","selected"):void 0})})}r.find(".modify-info-skill").find(".SlectBox").SumoSelect({csvDispCount:12,forceCustomRendering:!0,search:!0}),$.validator.addMethod("isImage",function(o,i){return this.optional(i)||/\w*.jpg|\w*.png|\w*.gif/.test(o)},"只能上传图片"),$.validator.addMethod("isToLarge",function(o,i){var n=i.files[0];return this.optional(i)||n.size/1024<3072},"文件大小不能超过3M"),h.validate({rules:{email:{required:!0,email:!0},picture:{isImage:!0,isToLarge:!0}},messages:{email:{required:"邮箱不能为空",email:"邮箱格式不合格"},picture:{isImage:"只能上传图片",isToLarge:"文件大小不能超过3M"}},errorElement:"p",errorContainer:!0,errorClass:"valid-error",validClass:"valid-pass"}),y.on("change",function(){var o=this.files[0];if(g.html(o.name),h.validate().element(this),!h.validate().element(this))return void y.blur();var i=new FileReader;i.readAsDataURL(o),i.onload=function(o){$(".item-img-result").attr("src",this.result).show(),$(".item-show-title").hide(),k.text("").hide()}}),T.on("click",function(){return h.valid()&&r.find("#update-info-form").submit(),!1})}})}else if("modify-person-password"===o){var C=r.data("user"),q=r.find("#update-password-form"),I=q.find(".update-form-operations").find(".btn-submit"),S=r.find("#update-old-password"),P=r.find("#update-new-password"),L=q.find("#update-username"),D=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+C;r.find(".modify-restul-info").hide(),S.val(""),P.val(""),q.find("#update-new-password-again").val(""),$.ajax({url:D,type:"POST",dataType:"json",success:function(o){L.val(o.voucher.username)}}),q.validate({rules:{password:{required:!0,rangelength:[6,40]},newPassword:{required:!0,rangelength:[6,40]},newPasswordAgain:{required:!0,rangelength:[6,40],equalTo:"#update-new-password"}},messages:{password:{required:"未输入原密码",rangelength:"密码长度为6-40位"},newPassword:{required:"未输入新密码",rangelength:"密码长度为6-40位"},newPasswordAgain:{required:"未输入确认密码",rangelength:"密码长度为6-40位",equalTo:"两次输入的密码不一致"}},errorElement:"p",errorContainer:!0,errorClass:"valid-error",validClass:"valid-pass"});var O=!1;I.on("click",function(){if(!O){O=!0;var o=S.val(),i=P.val(),n=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/updatePassword.action?id="+C+"&username="+L.val()+"&password="+o+"&newPassword="+i;q.valid()&&$.ajax({url:n,type:"POST",dataType:"text",success:function(o){var i=o.trim();if(O=!1,"success"===i){r.hide(),a.hide();var n=$("<div>"),e="<span>已经保存成功</span>";n.html(e).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#58f69e",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){n.fadeOut(300),document.body.removeChild(n[0])},700)})}else if("fail"===i){var t=r.find(".modify-restul-info");t.html("账号和原始密码不匹配").show()}else if("illegal"===i){var t=r.find(".modify-restul-info");t.html("密码的格式不正确").show()}}})}return!1})}a.css("bottom",t).show(100,function(){r.css("top","-100%").show();var e=r.height(),s=(i-e)/2;"modify-person-info"===o&&r.find(".modify-info-skill").find(".CaptionCont").on("click",function(){e+=r.find(".modify-info-skill").find(".optWrapper").height(),n=n>e?n:e,t=i-(n+30),t=t>0?0:t,a.css("bottom",t)}),s=s>10?s:10,n=n>e?n:e,t=i-(n+30),t=t>0?0:t,a.css("bottom",t),r.animate({top:s},function(){r.siblings().hide()})})}}),s.on("click",function(){a.hide(function(){a.children().hide()})}),f.on("click",function(){a.hide(function(){a.children().hide()})}),l.on("click",function(){a.hide(function(){a.children().hide()})}),a.on("click",function(o){o.target===this&&a.hide().children().hide()}),v.on("click",function(){}),w.on("click",function(){var o=$("body"),i=(o.height(),$(window).height()),n=$(document).height(),e=0,t=$("#create-project-container"),a=t.find("#create-project-form"),r=0,s=a.find(".project-form-operations").find(".btn-submit"),d=a.find(".project-form-operations").find(".btn-cancel"),l=0;$(document).scrollTop(10),setTimeout(function(){t.css("bottom",e).show(100,function(){a.css({opacity:"0",top:"-100%"}).show(),r=a.outerHeight(),l=i/2-r/2,l=l>20?l:10,r+=20,n=n>r?n:r,e=i-n,e=e>0?0:e,t.css("bottom",e),a.animate({top:l,opacity:"1"},100)}).on("click",function(o){o.target===this&&$(this).hide(function(){a.hide()})})},100),d.on("click",function(){return t.trigger("click"),!1});var c=!1;return s.on("click",function(){if(!c){c=!0;var o=a.find(".projectname"),i=a.find(".projectdesc"),n=a.find(".sortid"),e=a.find(".username"),t=a.find(".password"),r=o.val(),s=i.val(),d=n.val(),l=e.val(),f=t.val(),u=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/addProject?projectname="+r+"&projectdesc="+s+"&sortid="+d+"&authorname="+l+"&projectpassword="+f;console.log(u),$.ajax({url:u,type:"POST",dataType:"text",success:function(o){c=!1;var i=o.trim();if(res=i.split(","),"success"===res[0]){var n=$("<div>"),e="<span>项目创建成功</span>";n.html(e).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#58f69e",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){n.fadeOut(300),document.body.removeChild(n[0]),window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/showProject.action"},1200)})}else if("fail"===res[0]){var n=$("<div>"),e="<span>项目创建时出错</span>";n.html(e).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#E29685",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){n.fadeOut(300),document.body.removeChild(n[0])},1200)})}else if("illegal"===res[0]){var n=$("<div>"),e="<span>"+res[1]+"</span>";n.html(e).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#E29685",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){n.fadeOut(300),document.body.removeChild(n[0])},1200)})}}})}return!1}),!1})});