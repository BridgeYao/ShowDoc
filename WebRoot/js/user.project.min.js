$(function(){var o=$("#header"),i=o.find("#user-center"),n=i.find(".user-portraint").eq(0),e=o.find(".sub-nav").eq(0),t=e.find(".sub-btn"),a=o.find("#user-exit").find(".btn-exit"),r=$("#mask-container"),s=r.find("#person-info"),d=s.find(".btn-back"),c=r.find("#modify-person-password"),l=(c.find(".btn-submit"),c.find(".btn-cancel")),f=r.find("#modify-person-info"),u=(f.find(".btn-submit"),f.find(".btn-cancel")),p=!1,h=$("body").children(".modify-info-result").text().trim(),m=$("#main"),w=m.find(".project-list"),v=w.find(".project-item").find(".btn-detail"),g=w.find(".project-item-add").find(".project-btn");if("success"===h){var b=$("<div>"),y="<span>已经保存成功</span>";b.html(y).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#58f69e",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){b.fadeOut(300),document.body.removeChild(b[0])},700)})}a.on("click",function(o){var i=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/exitVoucher.action";window.location.href=i,o.preventDefault()}),i.hover(function(o){p||(p=!0,e.show(100))},function(o){e.hide(100,function(){p=!1})}),n.hover(function(){$(this).addClass("rotate")},function(){$(this).removeClass("rotate")}),t.on("click",function(){var o=$(this).data("dist"),i=$(window).height(),n=$(document).height(),t=i-(n+30);if(t=t>0?0:t,e.hide(),void 0!==o){var a=$("#"+o),i=$(window).height();if("person-info"===o){var s=a.data("user"),d=a.find(".item-name-content"),c=a.find(".item-email-content"),l=a.find(".item-portraint-content"),f=a.find(".info-item-skill"),u=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+s;$.ajax({url:u,type:"GET",dataType:"json",success:function(o){d.text(o.voucher.username),c.text(o.voucherInfo.email);var i=o.voucherInfo.skill,n="";if(null===i)n='<span class="item-skill-title">编程技能</span><span class="item-skill-other">无</span>',f.html(n);else{var e=i.split("-"),t="",a=$('<ul class="item-skill-list">');$.each(e,function(o,i){t=t+'<li class="item-skill-item"><span class="item-skill-content">'+i+"</span></li>"}),a.html(t),n='<span class="item-skill-title">编程技能</span>',f.html(n),f.append(a)}var r=$("<img />"),s=window.location.protocol+"//"+window.location.host+o.voucherInfo.picture;r.on("load",function(){l.attr("src",s).hover(function(){l.addClass("rotate")},function(){l.removeClass("rotate")})}),r.attr("src",s)}})}else if("modify-person-info"===o){var p=a.data("user"),h=a.find("#update-info-form"),m=a.find("#modify-info-username"),w=a.find("#modify-info-email"),v=a.find(".modify-info-portraint"),g=v.find(".item-upimg-name"),b=v.find(".item-img-result"),y=v.find("#modify-picture"),x=v.find(".valid-error"),k=a.find(".modify-info-skill").find("#modify-skill").find("option"),j=a.find(".modify-form-operations").find(".btn-submit"),T=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+p;b.hide().siblings().show(),$.ajax({url:T,type:"GET",dataType:"json",success:function(o){m.val(o.voucher.username),w.val(o.voucherInfo.email);var i=$("<img />"),n=window.location.protocol+"//"+window.location.host+o.voucherInfo.picture;i.on("load",function(){b.attr("src",n).show().siblings().hide()}),i.attr("src",n);var e=o.voucherInfo.skill;if(null!=e){var t=e.split("-");k.each(function(){var o=this;$.each(t,function(i,n){if($(o).val()===n)return void $(o).attr("selected","selected")})})}a.find(".modify-info-skill").find(".SlectBox").SumoSelect({csvDispCount:12,forceCustomRendering:!0,search:!0}),$.validator.addMethod("isImage",function(o,i){return this.optional(i)||/\w*.jpg|\w*.png|\w*.gif/.test(o)},"只能上传图片"),$.validator.addMethod("isToLarge",function(o,i){var n=i.files[0];return this.optional(i)||n.size/1024<3072},"文件大小不能超过3M"),h.validate({rules:{email:{required:!0,email:!0},picture:{isImage:!0,isToLarge:!0}},messages:{email:{required:"邮箱不能为空",email:"邮箱格式不合格"},picture:{isImage:"只能上传图片",isToLarge:"文件大小不能超过3M"}},errorElement:"p",errorContainer:!0,errorClass:"valid-error",validClass:"valid-pass"}),y.on("change",function(){var o=this.files[0];if(g.html(o.name),h.validate().element(this),!h.validate().element(this))return void y.blur();var i=new FileReader;i.readAsDataURL(o),i.onload=function(o){$(".item-img-result").attr("src",this.result).show(),$(".item-show-title").hide(),x.text("").hide()}}),j.on("click",function(){return h.valid()&&a.find("#update-info-form").submit(),!1})}})}else if("modify-person-password"===o){var C=a.data("user"),S=a.find("#update-password-form"),q=S.find(".update-form-operations").find(".btn-submit"),D=a.find("#update-old-password"),I=a.find("#update-new-password"),P=S.find("#update-username"),O=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/queryVoucherById.action?id="+C;a.find(".modify-restul-info").hide(),D.val(""),I.val(""),S.find("#update-new-password-again").val(""),$.ajax({url:O,type:"POST",dataType:"json",success:function(o){P.val(o.voucher.username)}}),S.validate({rules:{password:{required:!0,rangelength:[6,40]},newPassword:{required:!0,rangelength:[6,40]},newPasswordAgain:{required:!0,rangelength:[6,40],equalTo:"#update-new-password"}},messages:{password:{required:"未输入原密码",rangelength:"密码长度为6-40位"},newPassword:{required:"未输入新密码",rangelength:"密码长度为6-40位"},newPasswordAgain:{required:"未输入确认密码",rangelength:"密码长度为6-40位",equalTo:"两次输入的密码不一致"}},errorElement:"p",errorContainer:!0,errorClass:"valid-error",validClass:"valid-pass"});var L=!1;q.on("click",function(){if(!L){L=!0;var o=D.val(),i=I.val(),n=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/updatePassword.action?id="+C+"&username="+P.val()+"&password="+o+"&newPassword="+i;S.valid()&&$.ajax({url:n,type:"POST",dataType:"text",success:function(o){var i=o.trim();if(L=!1,"success"===i){a.hide(),r.hide();var n=$("<div>"),e="<span>已经保存成功</span>";n.html(e).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#58f69e",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){n.fadeOut(300),document.body.removeChild(n[0])},700)})}else if("fail"===i){var t=a.find(".modify-restul-info");t.html("账号和原始密码不匹配").show()}else if("illegal"===i){var t=a.find(".modify-restul-info");t.html("密码的格式不正确").show()}}})}return!1})}r.css("bottom",t).show(100,function(){a.css("top","-100%").show();var e=a.height(),s=(i-e)/2;"modify-person-info"===o&&a.find(".modify-info-skill").find(".CaptionCont").on("click",function(){e+=a.find(".modify-info-skill").find(".optWrapper").height(),n=n>e?n:e,t=i-(n+30),t=t>0?0:t,r.css("bottom",t)}),s=s>10?s:10,n=n>e?n:e,t=i-(n+30),t=t>0?0:t,r.css("bottom",t),a.animate({top:s},function(){a.siblings().hide()})})}}),d.on("click",function(){r.hide(function(){r.children().hide()})}),u.on("click",function(){r.hide(function(){r.children().hide()})}),l.on("click",function(){r.hide(function(){r.children().hide()})}),r.on("click",function(o){o.target===this&&r.hide().children().hide()}),v.on("click",function(){}),g.on("click",function(){var o=$("body"),i=(o.height(),$(window).height()),n=$(document).height(),e=0,t=$("#create-project-container"),a=t.find("#create-project-form"),r=0,s=a.find(".project-form-operations").find(".btn-submit"),d=a.find(".project-form-operations").find(".btn-cancel"),c=0;$(document).scrollTop(10),setTimeout(function(){t.css("bottom",e).show(100,function(){a.css({opacity:"0",top:"-100%"}).show(),r=a.outerHeight(),c=i/2-r/2,c=c>20?c:10,r+=20,n=n>r?n:r,e=i-n,e=e>0?0:e,t.css("bottom",e),a.animate({top:c,opacity:"1"},100)}).on("click",function(o){o.target===this&&$(this).hide(function(){a.hide()})})},100),a.find(".projectname").on("blur",function(o){var i=$(this).val(),n=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/checkProject/"+i;$.ajax({url:n,type:"POST",dataType:"text",success:function(o){var i=o.trim();"success"===i?console.log("success"):"fail"===i?console.log("fail"):"illegal"===i&&console.log("illegal")}}),o.preventDefault()}),d.on("click",function(){return t.trigger("click"),!1});var l=!1;return s.on("click",function(){if(!l){l=!0;var o=a.find(".projectname"),i=a.find(".projectdesc"),n=a.find(".sortid"),e=a.find(".username"),t=a.find(".password"),r=o.val(),s=i.val(),d=n.val(),c=e.val(),f=t.val(),u=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/addProject?projectname="+r+"&projectdesc="+s+"&sortid="+d+"&authorname="+c+"&projectpassword="+f;$.ajax({url:u,type:"POST",dataType:"text",success:function(o){var i=o.trim();if(res=i.split(","),"success"===res[0]){var n=$("<div>"),e="<span>项目创建成功</span>";n.html(e).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#58f69e",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){n.fadeOut(300),document.body.removeChild(n[0]),l=!1,window.location.href=window.location.protocol+"//"+window.location.host+"/ShowDoc/project/showProject.action"},1200)})}else if("fail"===res[0]){var n=$("<div>"),e="<span>项目创建时出错</span>";n.html(e).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#E29685",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){n.fadeOut(300),document.body.removeChild(n[0]),l=!1},1200)})}else if("illegal"===res[0]){var n=$("<div>"),e="<span>"+res[1]+"</span>";n.html(e).css({position:"absolute",left:"50%",marginLeft:"-15px",top:"10%",lineHeight:"35px",backgroundColor:"#E29685",color:"#fff",padding:"10px",borderRadius:"5px",display:"none"}).appendTo($("body")).show(function(){setTimeout(function(){n.fadeOut(300),document.body.removeChild(n[0]),l=!1},1200)})}else{var t=o.replace(/\s/,""),a=t.indexOf('<h3 class="error-info">')+'<h3 class="error-info">'.length,r=t.lastIndexOf("</h3>"),s=t.substring(a,r),d=window.location.protocol+"//"+window.location.host+"/ShowDoc/",c=d+"exception/operateVoucherHandle.action?message="+s;window.location.href=c}}})}return!1}),!1})});