$(function(){var e=$("#register-username"),r=$("#register-form"),o=r.find(".border-item"),i=$("#register-picture"),t=!1,s=!0,a=$("#register-password"),n=$("#register-checkpwd"),c=$("#register-email"),l=$("<img />"),d=r.find("#register-checkImg"),u=r.find("#show-checkImg"),m=r.find(".checkImg-icon"),g=r.find(".checkImg-error-info"),h=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/getCaptchar.action?temp="+(new Date).getTime().toString(36),f=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/getVcode.action";$(".SlectBox").SumoSelect({csvDispCount:12,forceCustomRendering:!0,search:!0}),l.on("load",function(){u.attr("src",h)}),l.attr("src",h),u.on("click",function(){h=window.location.protocol+"//"+window.location.host+"/ShowDoc/voucher/getCaptchar.action?temp="+(new Date).getTime().toString(36),l.on("load",function(){u.attr("src",h),m.html(""),d.focus(),g.hide(),$loginSubmit.attr("disabled","disabled").css("cursor","not-allowed")}),l.attr("src",h)}),o.on("click",function(){o.removeClass("border-active-item").addClass("border-item"),$(this).removeClass("border-item").addClass("border-active-item")}),i.on("change",function(){var e=this.files[0];if(void 0===e||!/image\/\w+/.test(e.type))return void alert("文件必须为图片");var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){$(".item-img-result").attr("src",this.result).show(),$(".item-show-title").hide()}}),d.on("blur",function(){var e=d.val();$.ajax({url:f,type:"GET",dataType:"text",async:!1,success:function(r){var o=r.trim();e===o?(m.css("color","#87F880").html("&#xe900;").show(),g.hide()):(m.css("color","#F9998E").html("&#xe901;").show(),g.show())}})}),$("#register-form").validate({rules:{"voucher.username":{required:!0,rangelength:[6,15]},"voucher.password":{required:!0,rangelength:[6,40]},passwordAgain:{required:!0,rangelength:[6,40],equalTo:"#register-password"},"voucherInfo.email":{required:!0,email:!0}},messages:{"voucher.username":{required:"未输入用户名",rangelength:"用户名为6-15位"},"voucher.password":{required:"未输入密码",rangelength:"密码长度为6-40位"},passwordAgain:{required:"未输入确认密码",rangelength:"密码长度为6-40位",equalTo:"两次输入的密码不一致"},"voucherInfo.email":{required:"未输入邮箱",email:"无效的电子邮件地址"}},onfocusout:!1,onkeyup:!1,errorClass:"valid-error",validClass:"valid-pass",errorElement:"i",errorContainer:!0}),function(){$("#register-form").validate().element(e),$("#register-username-error").css("opacity","0")}(),$("#form-submit").bind("click",function(e){return s=!1,$("#register-username-error").css("opacity","1"),$("#register-form").valid()&&t&&$("#register-form").submit(),!1}),e.on("blur",function(){$("#register-username-error").css("opacity","1");var r=$(this).val(),o="/ShowDoc/voucher/queryByName.action?username="+r;$("#register-form").validate().element(this)&&$.ajax({type:"POST",url:o,dataType:"text",success:function(r){var o=r.trim();if("success"===o)t=!0;else if("fail"===o)t=!1,e.removeClass("valid-pass").addClass("valid-error").siblings("i").text("用户名已经被注册.").css("display","inline");else if("illegal"===o)e.removeClass("valid-pass").addClass("valid-error").siblings("i").text("用户名应该为6~15位.").css("display","inline");else{var i=r.replace(/\s/,""),s=i.indexOf("body>")+"body>".length,a=i.lastIndexOf("</body>"),n=i.substring(s,a),c=window.location.href+"exception/operateVoucherHandle.action?message="+n;window.location.href=c}}})}),a.on("blur",function(){s||$("#register-form").validate().element(this)}),n.on("blur",function(){s||$("#register-form").validate().element(this)}),c.on("blur",function(){s||$("#register-form").validate().element(this)})});